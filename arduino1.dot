digraph finite_state_machine {
	compound = true;
	rankdir = LR;
	ranksep="1";
	nodesep="0.1";

	size = "8,6";
	ratio = fill;	

	node [shape=box,style="rounded,filled",color=white,fontname="Times-Italic",fontcolor="Grey"];
	style = filled;
	color = lightgrey;

	edge [fontsize = 10];

	subgraph cluster_loopend {
        style = invis;
        loopEnd [label="Repeat loop"]
    }

	subgraph cluster_loop {
		label = "loop() Function";
		readSensor1 [label="Read sensor #1 (temperature)"];
                
        input1Idle [shape=ellipse,fontname="Times",fontcolor="Black"]
        input1Changed [shape=ellipse,fontname="Times",fontcolor="Black"]
        input1Sending [shape=ellipse,fontname="Times",fontcolor="Black"]

		readSensor2;
		readSensor3;

        sendTransceiverMessage [label="Send transceiver message"];

        transceiverIdle [shape=ellipse,fontname="Times",fontcolor="Black"]
        transceiverSending [shape=ellipse,fontname="Times",fontcolor="Black"]
        transceiverSent [shape=ellipse,fontname="Times",fontcolor="Black"]

        waitForTransceiverDownlink [label="Wait for transceiver downlink"];
        pause10seconds [label="Pause 10 seconds"];
	}    

	subgraph cluster_loopbegin {
        style = invis;
        loopBegin [label="Start loop"]
    }

	subgraph cluster_setup {
		label = "setup() Function";
		setupSensor1;
		setupSensor2;
		setupSensor3;
        setupTransceiver;
	}

    loopEnd -> loopBegin [constraint=false];

}
